#cloud-config

chpasswd:
  list: |
    root:r00tme
    ubuntu:ubuntu
  expire: False
ssh_pwauth: True
disable_root: False
ssh_authorized_keys:
 - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAEAQDLCJHta/5O2C2MXRegwo+bJUiqbkESr+RwoH/VIdb4L0JDlVsqV+K+BOBjLZy3vwzWCaSackvshoZHAwGvvfGXjtLbhAYs6QWWHODf/XWBvOW4a96fbTToNpV1dXkHAGqlJMYln3GKVD0o9b69iQUTcLILJhWQjCoTjZsvTtP9OYn9YLfuoxhaaU3PazZVhZYml4Ca/3ns9vNQ/m+v4nh82ysyflGKYozEq0pl8VH0Ydy/FtOO98PhQx3crrivu3qghubntVRQnULUmlDSFhMff+ukLVdj2U0AdSBatlJuaSofWUMAQkv0Ia/om9doDGv2TqkXhJnZdGaWJwmuh6rKIZr7d7TYTD6Uag3wJ1NKiDETRNtmMCLuniEJzPO4asBpSSWGyVatyrNmAgBb6XCeZRkRcYvTXdA5OESKG3HJeguk0XCrjosIEYcvxyye9SgA8U73jWdDUdh0yIHLWcfrgC2eynE1uBnTPNBvtnf9pKqMEp5opdRAUhckhPRxJQ2JHcYMAFnq7gz1bL2boL2ElZOqHBx9qgv0ZKnk+YXqhyp2EP2JK0urd0EHMqkGUsRc7D0FSrz+j4lSkd71sHu3tMgwIrgDR55wYMBBRXTrR8pGTMnGldDBaxvUCgWnlsTQJdjs9xCM5gcJzzgZgkRBmrTOUkw2ABre6KMRAmQ4Zg3HxO0MBr5rfV5glWXuDJXsEowLPp/NQ+3X7PIU9LAtKkcZPWC3MayoFdEdNpKieCgOfRAiwJ34fWz4ozM0IvENmUmCKz8+yDAOeupJJ1/367Rl3+U8XTsDNSsqcmsRdr8ZnUIN0662FGr/nHkVaDq79rEywt/V2eMLWyunF0FUUnbwBB8/J0hgIQPX1ncziuzPTF/YCTR6lgVEtvNHPI1xTQsaVQkF9Whu9Eq6Gz1cFq6H/abb1DLJAoO1Cy0HjoT8MjwOICVcsrqxGXsNRBsv4fCxOaz6+WyVWz2O5gpNKOLLmenr9JbiTGjamjfl9dDempRROSDjsJJY6TPdRb0WBuk3i6mOAsAYeBHoargi+a+dQ1IDzGdVY2mUXtDTA6HluZVvzEKnAR6QzuEdRLOrbteETRQ3cV9STXgscCTokzDNzhYbkLUIl/SRBYBdPMiR9TgW+m/0IJkBTEEUuDtYVzyHezV94F17vzpK+xbRdk3/WmWPScPDkc9tDp0AGLdZ/FAkNzGM1VE8G5OJ7OduogIdIQW6yR8y+CP1O4e2WYZ3M0IjJFX8pc/zBinUBNOBvgAzO8aSXTgxXbs/Q1fcv7htmJZ/3nnB4U6N85tq5oklCWulk3tIFI5pMGiQUoQCW8PH2nwasaKKtOInBZMWm8B2K0c5bU2/bKRcXJNJ asheplyakov@as-ubuntu
 - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAEAQDAyY13SlGh86kP6hHOA4fwA5Lgfh8CBIL+TjMMIQXvDcuOcBB+N0ATTGiBaDO7IxHcfM5CZgLJEBg4SPQsfaZDTAHviOSa58Au85PNGAzxU9ufqMzSj1xEDCZXIO4diQYfpqMGut6LUClDnccStDFjoG7bA6O3EUgbdqMFJWSK6BFR4GlskjDBAn79r1ydR7vdaQ4+8u2EdIzKsUK3Yy44QAHREhBQvPiS7361hEsYLIjlvpHzYaYHredOvUGQp9pPvDBqzGmXo/9TqNHiXQoQb4VejHY62KJrKUGPRCWMBiBA5GexzW1MejqaEQK80RRbIcd6uJKsgQCR6A9u4E3yQzw21AKXBzB32pSniSVT++t1DUOb0zkORLE8sYN5y9rdMv1zzlxhE6CRgDJ/VRMZp777uUANcEkEiWTZOZyxJqVCjbHr3aBsKz6vf+1xHergYjcdfm14YpZ5eemegFdP2TJnLqnqb5eHxoq1R7cC9vqlangMs6Hk9by27RIlkeWMxRMLDxX3LrgBQwF+W/Uo5GACpvUyzZUZhrrEFaR4stVXq5woBp6L1wEgV0NjjHyE5dYkrAHj8SDnoS4V9rKJEN7FimKQfP6BhNfM3L1wufJ8iTCLYEau8ZgwRsoijdnNK8nDlka3aedfuR/PZepjz04vpk5GPH+1KpKQILvgLcrcX+0bIvwRaYCQfLtVciU7Xvw7Hz5FyAjJt6Y9cjDfr+7ai7GqRk4gAKWngdMw6KwHrAB0OcHw35bCkUWi/qsBpARG6lefrad1qCeiwSnLVByOQgNzPWS5SKb4YoUy+2t7LIEvmICM+jx9EMF9AWOjgigIiVemhCNSE0fxuK3QJpL7eBIjAiQGoW1M/JeNBW1nhNffknS2qNRXUCexke/OdP4F5zhZC/syqv0wVb/HX4rDij0GhgWMiiRcws1NA+dOyXRsR0SYvkTQ3YlaiDePK4oz3+lxPZj9pC1OoobsjWgPkPjUOu0dBGW6FXQPq1FdIw29/orU3fFsyzjkbYW9GO6lSgINdr0/6QGIykSJHh34bPn8CQHEvxH49eacCATE/P9X4Ce37x+uKa+lcxxWiqeCwwwsj4iAZLrb034Z9qA7DU1Lmpom4VdHu472gXmI26PUwCKMxOT2lcSUTDTQi5KFBM72vO8fPSEU3oOiIb6YbvW2G9i64Y6q7xx0tGtSXSfQPs+6r2vX0N3epiG9rxWCbH0gFsdT4cp2M8RDgRysKSlzaKUMUR6ZqiKTXS+X+TT88SLJ0KmXNNuhc6DtF9eoJXqBVZnsHzpH65Hpso870KIKtm1mBDggkYnYPipLBOnG/01O8pDzmILz1aRp/dg/3W7uKCNqQK8gEDLb asheplyakov@alena

bootcmd:
 - echo 'Acquire::http::proxy "http://192.168.128.1:3128";' > /etc/apt/apt.conf.d/90_use_proxy
 - echo 'APT::Get::AllowUnauthenticated "1";' > /etc/apt/apt.conf.d/90_allow_unsigned_repos
 - echo 'deb http://ru.archive.ubuntu.com/ubuntu trusty          main universe multiverse restricted' > /etc/apt/sources.list
 - echo 'deb http://ru.archive.ubuntu.com/ubuntu trusty-updates  main universe multiverse restricted' >> /etc/apt/sources.list
 - echo 'deb http://ru.archive.ubuntu.com/ubuntu trusty-security main universe multiverse restricted' >> /etc/apt/sources.list
 - echo 'deb http://mirror.fuel-infra.org/mos-repos/ubuntu/7.0 mos7.0 main' >> /etc/apt/sources.list
 - echo 'deb http://asheplyakov.srt.mirantis.net/Public/debian/ceph-hammer-trusty trusty main' >> /etc/apt/sources.list
 - "echo 'Package: ceph-deploy' > /etc/apt/preferences"
 - "echo 'Pin: release n=mos*' >> /etc/apt/preferences"
 - "echo 'Pin-Priority: 1051' >> /etc/apt/preferences"
 - "echo >> /etc/apt/preferences"
 - "echo 'Package: *' >> /etc/apt/preferences"
 - "echo 'Pin: release n=mos*' >> /etc/apt/preferences"
 - "echo 'Pin-Priority: 10' >> /etc/apt/preferences"
 - "echo >> /etc/apt/preferences"
 - "echo 'Package: *' >> /etc/apt/preferences"
 - "echo 'Pin: release l=sa-hammer-trusty' >> /etc/apt/preferences"
 - "echo 'Pin-Priority: 1051' >> /etc/apt/preferences"
 - "wget -O - http://mirror.fuel-infra.org/mos-repos/ubuntu/7.0/archive-mos7.0.key | apt-key add -"
 - echo 'nameserver 192.168.122.1' > /etc/resolv.conf
 - echo 10.253.0.1 sahost >> /etc/hosts
 - echo 10.253.0.2 saceph-mon >> /etc/hosts
 - echo 10.253.0.3 saceph-osd1 >> /etc/hosts
 - echo 10.253.0.4 saceph-osd2 >> /etc/hosts
 - echo 10.253.0.5 saceph-osd3 >> /etc/hosts
 - echo 'auto eth1' > /etc/network/interfaces.d/eth1.cfg
 - echo 'iface eth1 inet manual' >> /etc/network/interfaces.d/eth1.cfg
 - echo 'up ip link set up dev eth1' >> /etc/network/interfaces.d/eth1.cfg
 - echo 'up ip addr add 10.253.0.5/24 brd 10.253.0.255 dev eth1' >> /etc/network/interfaces.d/eth1.cfg
 - echo 'down ip link set down dev eth1' >> /etc/network/interfaces.d/eth1.cfg
 - echo 'down ip addr del 10.253.0.5/24 dev eth1' >> /etc/network/interfaces.d/eth1.cfg
 - apt-get update
 - apt-get dist-upgrade -y
 - apt-get install -y haveged ceph-deploy nfs-common libstdc++6-4.8-dbg gdb vim-nox git build-essential devscripts ipython
 - sed -re '/^\/usr\/share\/man/ d' -i /var/lib/dpkg/info/ceph-deploy.list
 - "cd /root && env HTTP_PROXY=http://192.168.122.1:3128 dget -u -x http://ru.archive.ubuntu.com/ubuntu/pool/main/c/ceph/ceph_0.94.2-0ubuntu0.15.04.1.dsc"
 - mkdir -m755 -p /media/work
 - "echo '10.253.0.1:/home/asheplyakov/work /media/work nfs rw,tcp,hard,noatime 0 0' > /etc/fstab"

write_files:
 - path: /root/.gdbinit
   permissions: '0644'
   content: |
     python sys.path.append("/usr/share/gcc-4.8/python")
     break 'ReplicatedPG::maybe_handle_cache(std::tr1::shared_ptr<OpRequest>, bool, std::tr1::shared_ptr<ObjectContext>, int, hobject_t const&, bool, bool)'

apt_preserve_sources_list: True
